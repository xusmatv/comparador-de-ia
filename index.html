<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comparador IA â€“ HARTâ€¯vsâ€¯Modelos Gratis</title>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body{font-family:system-ui,sans-serif;background:#fafafa;padding:2rem}
  .container{max-width:1100px;margin:auto}
  textarea{width:100%;height:100px;padding:.6rem;font-size:1rem}
  .models{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
           gap:.8rem;margin:1rem 0}
  .model{display:flex;align-items:center}
  .model input{margin-right:.4rem}
  .result{border:1px solid #ddd;padding:.8rem;margin-top:1rem;
          border-radius:.4rem;background:#fff}
  .spinner{border:4px solid #eee;border-top:4px solid #667eea;
          border-radius:50%;width:36px;height:36px;
          animation:spin 1s linear infinite;margin:auto}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ”„ Comparador IA â€“ HARTâ€¯vsâ€¯Modelos Gratis</h1>

  <!-- Prompt --------------------------------------------------- -->
  <label for="prompt">ğŸ“ Prompt (espaÃ±ol o inglÃ©s)</label>
  <textarea id="prompt"
    placeholder="Ej.: un astronauta montado en un caballo sobre la luna, estilo Van Gogh"></textarea>

  <!-- SelecciÃ³n de modelos ------------------------------------- -->
  <div class="models">
    <div class="model"><input type="checkbox" id="m_hart" checked>
      <label for="m_hart">HARTâ€¯(Replicate)</label></div>
    <div class="model"><input type="checkbox" id="m_sd" checked>
      <label for="m_sd">Stableâ€‘Diffusionâ€¯2â€‘1â€¯(HFâ€‘Space)</label></div>
    <div class="model"><input type="checkbox" id="m_pixart" checked>
      <label for="m_pixart">PixArtâ€‘Î±â€¯(HFâ€‘Space)</label></div>
    <div class="model"><input type="checkbox" id="m_sdxl" checked>
      <label for="m_sdxl">SDâ€‘XLâ€‘Turboâ€¯(HFâ€‘Space)</label></div>
    <div class="model"><input type="checkbox" id="m_dalle">
      <label for="m_dalle">DALLÂ·Eâ€¯3â€¯(OpenAIâ€‘pago)</label></div>
  </div>

  <!-- ResoluciÃ³n ---------------------------------------------- -->
  <label for="size">ğŸ“ ResoluciÃ³n</label>
  <select id="size">
    <option value="512x512">512â€¯Ã—â€¯512 (rÃ¡pido)</option>
    <option value="1024x1024" selected>1024â€¯Ã—â€¯1024 (alta calidad)</option>
  </select>

  <br><br>
  <button id="genBtn"
    style="padding:.6rem 1rem;font-size:1rem;background:#667eea;color:#fff;
           border:none;border-radius:.4rem;cursor:pointer">
    ğŸš€â€¯Generar
  </button>
  <div id="loader" class="spinner" style="display:none;margin-top:1rem"></div>

  <!-- Ãrea donde aparecen los resultados -->
  <div id="results"></div>
</div>

<!-- ======================  SCRIPT  ====================== -->
<script>
/* ---------- URLs pÃºblicas (sin token) ---------------------- */
const IF_RAMES = {
  hart:    {url:"https://replicate.com/chenxwh/hart?embed=true",
           name:"HARTâ€¯(Replicate)"},
  sd:      {url:"https://stabilityai-stable-diffusion.hf.space",
           name:"Stableâ€‘Diffusionâ€¯2â€‘1"},
  pixart:  {url:"https://pixart-alpha-pixart-alpha.hf.space",
           name:"PixArtâ€‘Î±"},
  sdxl:    {url:"https://stabilityai-sdxl-turbo.hf.space",
           name:"SDâ€‘XLâ€‘Turbo"}
};

/* ---------- Embeds (iframes) + cronÃ³metro ---------------- */
async function embedIframe(key,prompt,size){
  const container=document.createElement('div'); container.className='result';
  const title=document.createElement('h3'); title.textContent=IF_RAMES[key].name;
  container.appendChild(title);

  const [w,h]=size.split('x');
  const src=`${IF_RAMES[key].url}?prompt=${encodeURIComponent(prompt)}&width=${w}&height=${h}`;
  const iframe=document.createElement('iframe');
  iframe.src = src;
  iframe.style.width = '100%';
  iframe.style.height = '620px';
  iframe.setAttribute('loading','lazy');
  iframe.setAttribute('allowfullscreen','');
  container.appendChild(iframe);
  document.getElementById('results').appendChild(container);
}

/* ---------- Pollinations (sin clave) ---------------------- */
async function pollinationsGenerate(prompt,size){
  const [w,h]=size.split('x');
  const url=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${w}&height=${h}&nologo=true`;
  const start=performance.now();
  const resp=await fetch(url);
  if(!resp.ok) throw new Error('Pollinations error');
  const blob=await resp.blob();
  const img=URL.createObjectURL(blob);
  const t=((performance.now()-start)/1000).toFixed(2);

  const card=document.createElement('div'); card.className='result';
  card.innerHTML = `<h3>Pollinations (free fallback)</h3>
                    <img src="${img}" style="max-width:100%;border-radius:.4rem;">
                    <p>â±â€¯Tiempo: <strong>${t}s</strong></p>
                    <a href="${img}" download="pollinations.png"
                       class="btn-download" style="margin-top:.5rem;display:inline-block;">
                      <i class="fas fa-download"></i>Â Descargar</a>`;
  document.getElementById('results').appendChild(card);
}

/* ---------- DALLÂ·Eâ€¯3 (requiere clave) â€“ OPCIONAL --------- */
const OPENAI_KEY = "";   // â† pon aquÃ­ tu APIâ€‘key de OpenAI si la tienes
async function openAIDALLE3(prompt,size){
  if(!OPENAI_KEY) return;
  const [w,h]=size.split('x');
  const start=performance.now();
  const resp=await fetch('https://api.openai.com/v1/images/generations',{
    method:'POST',
    headers:{'Authorization':`Bearer ${OPENAI_KEY}`,
             'Content-Type':'application/json'},
    body:JSON.stringify({model:'dall-e-3',prompt,size:`${w}x${h}`})
  });
  if(!resp.ok) throw new Error('OpenAI error');
  const data=await resp.json();
  const img=data.data[0].url;
  const t=((performance.now()-start)/1000).toFixed(2);
  const card=document.createElement('div'); card.className='result';
  card.innerHTML = `<h3>DALLÂ·Eâ€¯3 (OpenAIâ€¯â€‘â€¯pago)</h3>
                    <img src="${img}" style="max-width:100%;border-radius:.4rem;">
                    <p>â±â€¯Tiempo: <strong>${t}s</strong></p>
                    <a href="${img}" download="dalle3.png"
                       class="btn-download" style="margin-top:.5rem;display:inline-block;">
                      <i class="fas fa-download"></i>Â Descargar</a>`;
  document.getElementById('results').appendChild(card);
}

/* ---------- BotÃ³n â€œGenerarâ€ ------------------------------- */
document.getElementById('genBtn').onclick = async () => {
  const prompt = document.getElementById('prompt').value.trim();
  if(!prompt){ alert('Introduce un prompt'); return; }
  const size   = document.getElementById('size').value;

  // limpiar resultados y mostrar spinner
  document.getElementById('results').innerHTML = '';
  document.getElementById('loader').style.display = 'block';

  const jobs = [];
  if(document.getElementById('m_hart').checked)   jobs.push(embedIframe('hart',prompt,size));
  if(document.getElementById('m_sd').checked)    jobs.push(embedIframe('sd',prompt,size));
  if(document.getElementById('m_pixart').checked)jobs.push(embedIframe('pixart',prompt,size));
  if(document.getElementById('m_sdxl').checked)  jobs.push(embedIframe('sdxl',prompt,size));
  if(document.getElementById('m_dalle').checked)jobs.push(openAIDALLE3(prompt,size));
  jobs.push(pollinationsGenerate(prompt,size));   // siempre

  await Promise.all(jobs);
  document.getElementById('loader').style.display = 'none';
};

/* ---------- Gradio para los HF Spaces -------------------- 
   (necesario si los iframes no funcionan)                */
const script = document.createElement('script');
script.src = "https://gradio.app/js/gradio.js";
document.head.appendChild(script);
</script>
</body>
</html>
